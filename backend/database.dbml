Table "migrations" {
  "id" int4 [pk, not null, increment]
  "timestamp" int8 [not null]
  "name" varchar [not null]
}

Table "roles" {
  "id" int4 [pk, not null, increment]
  "name" text [unique, not null]
}

Table "user_info" {
  "id" int4 [pk, not null, increment]
  "user_id" uuid [unique, not null]
  "phone" text
  "emergency_name" text
  "emergency_phone" text
}

Table "address_data" {
  "id" int4 [pk, not null, increment]
  "street" text
  "number" text
  "floor" text
  "apartment" text
  "neighborhood" text
  "locality" text
  "province" text
  "postal_code" text
  "country" text
}

Table "common_data" {
  "id" int4 [pk, not null, increment]
  "user_id" uuid [unique, not null]
  "address_data_id" int4
  "sex" text
  "birth_date" date
  "birth_place" text
  "nationality" text
}

Table "teachers" {
  "user_id" uuid [pk, not null]
}

Table "secretaries" {
  "user_id" uuid [pk, not null]
  "is_directive" bool [not null, default: false]
}

Table "students" {
  "user_id" uuid [pk, not null]
  "legajo" text [unique, not null]
  "commission" int4
  "can_login" bool [default: true]
  "is_active" bool [default: true]
  "student_start_year" int2 [not null, default: `(EXTRACT(year FROM CURRENT_DATE))::smallint`]
}

Table "preceptors" {
  "user_id" uuid [pk, not null]
}

Table "users" {
  "id" uuid [pk, not null, default: `uuid_generate_v4()`]
  "name" text [not null]
  "last_name" text [not null]
  "email" text [unique, not null]
  "password" text [not null]
  "cuil" text [unique, not null]
  "role_id" int4 [not null]
}

Table "notices" {
  "id" int4 [pk, not null, increment]
  "content" text [not null]
  "visible_role_id" int4
  "created_by" uuid
  "created_at" timestamptz [not null, default: `now()`]
  "updated_at" timestamptz [not null, default: `now()`]
}

Table "academic_period" {
  "academic_period_id" int4 [pk, not null, increment]
  "period_name" text [not null]
  "partials_score_needed" int2 [not null, default: 2]
}

Table "commission" {
  "id" int4 [pk, not null, increment]
  "commission_letter" text
}

Table "subject_status_type" {
  "id" int4 [pk, not null, increment]
  "status_name" text [unique, not null]
}

Table "subjects" {
  "id" int4 [pk, not null, increment]
  "subject_name" text [not null]
  "academic_period_id" int4
  "order_no" int4
  "correlative" text
  "teacher_formation" text
  "subject_format" text
  "annual_workload" text
  "weekly_workload" text
}

Table "careers" {
  "id" int4 [pk, not null, increment]
  "career_name" text [not null]
  "academic_period_id" int4 [not null]
  "preceptor_id" uuid [not null]
  "created_at" timestamptz [not null, default: `now()`]
}

Table "career_subjects" {
  "id" int4 [pk, not null, increment]
  "career_id" int4 [not null]
  "subject_id" int4 [not null]
  "year_no" int2
  "period_order" int2
  "order_no" int4 [not null]

  Indexes {
    (career_id, order_no) [type: btree, name: "uq_career_subjects_career_orderno"]
    (career_id, subject_id) [type: btree, name: "uq_career_subjects_career_subject"]
    subject_id [type: btree, name: "idx_career_subjects_subject"]
  }
}

Table "subject_prerequisites_by_order" {
  "id" int4 [pk, not null, increment]
  "career_id" int4 [not null]
  "subject_order_no" int4 [not null]
  "prereq_order_no" int4 [not null]

  Indexes {
    (career_id, subject_order_no, prereq_order_no) [type: btree, name: "uq_subj_prereq_order"]
    (career_id, prereq_order_no) [type: btree, name: "idx_subj_prereq_order_prereq"]
    (career_id, subject_order_no) [type: btree, name: "idx_subj_prereq_order_subject"]
  }
}

Table "career_students" {
  "id" int4 [pk, not null, increment]
  "career_id" int4 [not null]
  "student_id" uuid [not null]
  "enrolled_at" date
}

Table "subject_commissions" {
  "id" int4 [pk, not null, increment]
  "subject_id" int4 [not null]
  "commission_id" int4 [not null]
  "teacher_id" uuid [not null]
  "active" bool [not null, default: true]

  Indexes {
    (subject_id, commission_id) [type: btree, name: "uq_subject_commission_subject_commission"]
    subject_id [type: btree, name: "idx_subject_commission_subject"]
    teacher_id [type: btree, name: "idx_subject_commission_teacher"]
  }
}

Table "subject_students" {
  "id" int4 [pk, not null, increment]
  "subject_id" int4 [not null]
  "student_id" uuid [not null]
  "enrollment_date" date

  Indexes {
    (subject_id, student_id) [type: btree, name: "uq_subject_students_subject_student"]
  }
}

Table "exams" {
  "id" int4 [pk, not null, increment]
  "subject_id" int4 [not null]
  "title" text
  "date" date
  "is_valid" bool [not null, default: true]
}

Table "exam_results" {
  "id" int4 [pk, not null, increment]
  "exam_id" int4 [not null]
  "student_id" uuid [not null]
  "score" numeric(4,2)
}

Table "exam_table" {
  "id" int4 [pk, not null, increment]
  "name" text [not null]
  "start_date" date [not null]
  "end_date" date [not null]
}

Table "final_exam_status" {
  "id" int4 [pk, not null, increment]
  "name" text [unique, not null]
}

Table "final_exams" {
  "id" int4 [pk, not null, increment]
  "exam_table_id" int4 [not null]
  "subject_id" int4 [not null]
  "exam_date" timestamptz [not null]
  "aula" text
}

Table "final_exams_students" {
  "id" int4 [pk, not null, increment]
  "final_exam_id" int4 [not null]
  "student_id" uuid [not null]
  "enrolled_at" timestamptz
  "score" numeric(4,2)
  "notes" text
  "status_id" int4
  "recorded_by" uuid
  "recorded_at" timestamptz
  "approved_by" uuid
  "approved_at" timestamptz

  Indexes {
    (final_exam_id, student_id) [type: btree, name: "uq_final_exams_students_final_student"]
  }
}

Table "student_subject_progress" {
  "id" int4 [pk, not null, increment]
  "subject_commission_id" int4 [not null]
  "student_id" uuid [not null]
  "status_id" int4
  "partial_scores" jsonb [note: 'Validated and trimmed by trg_enforce_partial_scores trigger.']
  "attendance_percentage" numeric(5,2) [not null, default: 0]
  "created_at" timestamptz [not null, default: `now()`]
  "updated_at" timestamptz [not null, default: `now()`]

  Indexes {
    (subject_commission_id, student_id) [type: btree, name: "uq_student_subject_progress_commission_student"]
    student_id [type: btree, name: "idx_student_subject_progress_student"]
  }
}

Ref "career_students_career_id_fkey":"careers"."id" < "career_students"."career_id" [delete: cascade]

Ref "career_students_student_id_fkey":"students"."user_id" < "career_students"."student_id" [delete: cascade]

Ref "career_subjects_career_id_fkey":"careers"."id" < "career_subjects"."career_id" [delete: cascade]

Ref "career_subjects_subject_id_fkey":"subjects"."id" < "career_subjects"."subject_id" [delete: cascade]

Ref "careers_academic_period_id_fkey":"academic_period"."academic_period_id" < "careers"."academic_period_id" [delete: restrict]

Ref "careers_preceptor_id_fkey":"preceptors"."user_id" < "careers"."preceptor_id" [delete: restrict]

Ref "FK_1ef323c6e620f95c60adab91908":"address_data"."id" < "common_data"."address_data_id"

Ref "FK_e5f11ef95c7821a3b30897fc9d7":"users"."id" < "common_data"."user_id"

Ref "exam_results_exam_id_fkey":"exams"."id" < "exam_results"."exam_id" [delete: cascade]

Ref "exam_results_student_id_fkey":"students"."user_id" < "exam_results"."student_id" [delete: cascade]

Ref "exams_subject_id_fkey":"subjects"."id" < "exams"."subject_id" [delete: cascade]

Ref "final_exams_exam_table_id_fkey":"exam_table"."id" < "final_exams"."exam_table_id" [delete: cascade]

Ref "final_exams_subject_id_fkey":"subjects"."id" < "final_exams"."subject_id" [delete: cascade]

Ref "final_exams_students_approved_by_fkey":"secretaries"."user_id" < "final_exams_students"."approved_by" [delete: set null]

Ref "final_exams_students_final_exam_id_fkey":"final_exams"."id" < "final_exams_students"."final_exam_id" [delete: cascade]

Ref "final_exams_students_recorded_by_fkey":"teachers"."user_id" < "final_exams_students"."recorded_by" [delete: set null]

Ref "final_exams_students_status_id_fkey":"final_exam_status"."id" < "final_exams_students"."status_id" [delete: set null]

Ref "final_exams_students_student_id_fkey":"students"."user_id" < "final_exams_students"."student_id" [delete: cascade]

Ref "FK_5091560ec8975434a5add94c411":"users"."id" < "notices"."created_by" [delete: set null]

Ref "FK_8edf397e84eebabdf5e5caae600":"roles"."id" < "notices"."visible_role_id" [delete: set null]

Ref "FK_43d31311c09cbaeac198842590f":"users"."id" < "preceptors"."user_id"

Ref "FK_81e71815c5d4bed8e8dae6ce734":"users"."id" < "secretaries"."user_id"

Ref "student_subject_progress_status_id_fkey":"subject_status_type"."id" < "student_subject_progress"."status_id" [delete: set null]

Ref "student_subject_progress_student_id_fkey":"students"."user_id" < "student_subject_progress"."student_id" [delete: cascade]

Ref "student_subject_progress_subject_commission_id_fkey":"subject_commissions"."id" < "student_subject_progress"."subject_commission_id" [delete: cascade]

Ref "FK_fb3eff90b11bddf7285f9b4e281":"users"."id" < "students"."user_id"

Ref "subject_commissions_commission_id_fkey":"commission"."id" < "subject_commissions"."commission_id" [delete: restrict]

Ref "subject_commissions_subject_id_fkey":"subjects"."id" < "subject_commissions"."subject_id" [delete: cascade]

Ref "subject_commissions_teacher_id_fkey":"teachers"."user_id" < "subject_commissions"."teacher_id" [delete: restrict]

Ref "subject_prerequisites_by_order_career_id_fkey":"careers"."id" < "subject_prerequisites_by_order"."career_id" [delete: cascade]

Ref "subject_students_student_id_fkey":"students"."user_id" < "subject_students"."student_id" [delete: cascade]

Ref "subject_students_subject_id_fkey":"subjects"."id" < "subject_students"."subject_id" [delete: cascade]

Ref "subjects_academic_period_id_fkey":"academic_period"."academic_period_id" < "subjects"."academic_period_id" [delete: set null]

Ref "FK_4668d4752e6766682d1be0b346f":"users"."id" < "teachers"."user_id"

Ref "FK_59c55ac40f267d450246040899e":"users"."id" < "user_info"."user_id"

Ref "FK_a2cecd1a3531c0b041e29ba46e1":"roles"."id" < "users"."role_id"

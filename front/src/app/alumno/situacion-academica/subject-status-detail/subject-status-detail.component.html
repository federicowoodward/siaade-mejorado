<p-dialog
  [(visible)]="visible"
  (onHide)="handleHide()"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '640px' }"
  [breakpoints]="{ '960px': '90vw', '600px': '96vw' }"
  [closeOnEscape]="true"
  [dismissableMask]="true"
  [header]="subject?.subjectName || 'Detalle de materia'"
>
  <ng-container *ngIf="subject; else emptyDetail">
    <div class="detail-meta">
      <div>
        <span class="meta-label">Estudiante</span>
        <p class="meta-value">{{ studentName || "No disponible" }}</p>
      </div>
      <div>
        <span class="meta-label">A침o</span>
        <p class="meta-value">{{ subject.yearLabel }}</p>
      </div>
      <div>
        <span class="meta-label">Comisi칩n</span>
        <p class="meta-value">{{ subject.commissionLabel || "Sin comisi칩n" }}</p>
      </div>
      <div>
        <span class="meta-label">Plan</span>
        <p class="meta-value">{{ subject.studyPlan || "No informado" }}</p>
      </div>
    </div>

    <div class="detail-section">
      <h4 class="section-title">Estado actual</h4>
      <div class="status-badges">
        <p-tag
          [value]="subject.accreditation || subject.condition || 'Sin estado'"
          [severity]="stateSeverity(subject.condition)"
        ></p-tag>
        <span class="final-score">
          Nota final: {{ subject.finalScore ?? "-" }}
        </span>
      </div>
      <p class="text-color-secondary m-0">
        {{ subject.finalExplanation }}
      </p>
    </div>

    <div class="detail-section">
      <h4 class="section-title">Notas del a침o</h4>
      <div class="partial-list">
        <span
          class="partial-chip"
          *ngFor="let note of subject.notes; trackBy: trackNote"
        >
          {{ note.label }}: {{ note.value ?? "-" }}
        </span>
      </div>
    </div>

    <div class="detail-section">
      <h4 class="section-title">Asistencia</h4>
      <p class="metric-value">{{ subject.attendancePct | number: "1.0-0" }}%</p>
    </div>

    <div
      class="pedagogic-alert"
      *ngIf="subject.pedagogicalMessage as pedagogicalMessage"
    >
      <i class="pi pi-info-circle"></i>
      <span>{{ pedagogicalMessage }}</span>
    </div>
  </ng-container>

  <ng-template #emptyDetail>
    <p class="text-color-secondary m-0">
      Selecciona una materia para ver su detalle.
    </p>
  </ng-template>
</p-dialog>

<div class="m-w-custom">
  <div class="flex justify-content-between align-items-center mb-3">
    <h2 class="m-0">
      {{ table()?.name || 'Mesa' }}
      <small class="text-color-secondary block">
        {{ table()?.start_date }} → {{ table()?.end_date }}
      </small>
    </h2>

    <div class="flex gap-2">
      <p-button
        label="Crear examen"
        icon="pi pi-plus"
        (onClick)="openCreate()"
      ></p-button>
      <p-button
        label="Volver"
        icon="pi pi-arrow-left"
        severity="secondary"
        (onClick)="back()"
      ></p-button>
    </div>
  </div>

  <p-table
    [value]="finals()"
    [paginator]="true"
    [rows]="10"
    responsiveLayout="scroll"
    [loading]="loading()"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Materia</th>
        <th>Fecha</th>
        <th>Hora</th>
        <th>Aula</th>
        <th style="width: 280px">Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-row>
      <tr>
        <td class="font-medium">{{ row.subject_name }}</td>
        <td>{{ row.exam_date }}</td>
        <td>{{ row.exam_time || '—' }}</td>
        <td>{{ row.aula || '—' }}</td>
        <td class="flex gap-2 flex-wrap">
          <p-button
            label="Abrir"
            icon="pi pi-arrow-right"
            (onClick)="openFinal(row)"
          ></p-button>
          <p-button
            label="Eliminar"
            icon="pi pi-trash"
            severity="danger"
            (onClick)="deleteFinal(row)"
          ></p-button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">
          <div class="flex justify-content-between align-items-center">
            <i class="pi pi-inbox mr-2"></i>
            No hay ningún examen en esta mesa, puedes crear uno.
            <p-button
              label="Crear examen"
              icon="pi pi-plus"
              styleClass="ml-2"
              (onClick)="openCreate()"
            ></p-button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Diálogo separado -->
<app-final-exam-create-dialog
  [visible]="showCreate()"
  (visibleChange)="showCreate.set($event)"
  [minDate]="minDate"
  [maxDate]="maxDate"
  (submit)="handleCreate($event)"
></app-final-exam-create-dialog>

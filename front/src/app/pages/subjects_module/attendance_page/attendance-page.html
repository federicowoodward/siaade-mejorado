<div class="m-w-custom">
  <div class="flex justify-content-between align-items-center mb-3">
    <h2 class="m-0">Asistencia • {{ subjectName() }}</h2>

    <div class="flex align-items-center gap-2">
      <label class="text-sm text-color-secondary">Mes</label>
      <p-autoComplete
        class="w-14rem"
        [suggestions]="monthSuggestions"
        (completeMethod)="searchMonths($event)"
        [dropdown]="true"
        [minLength]="0"
        [ngModel]="monthLabel"
        (ngModelChange)="onMonthChange($event)"
        placeholder="Mes"
      />

      <span class="text-sm text-color-secondary ml-2">Año {{ year() }}</span>

      <p-button
        label="Todos presentes"
        size="small"
        (onClick)="marcarTodos(true)"
      ></p-button>
      <p-button
        label="Todos ausentes"
        size="small"
        severity="secondary"
        (onClick)="marcarTodos(false)"
      ></p-button>

      <p-button
        label="Volver"
        icon="pi pi-arrow-left"
        severity="secondary"
        (onClick)="back()"
      ></p-button>
    </div>
  </div>

  <p-table
    [value]="students()"
    responsiveLayout="scroll"
    [tableStyle]="{ 'min-width': '80rem' }"
    [paginator]="true"
    [rows]="10"
  >
    <ng-template pTemplate="header">
      <tr>
        <th style="min-width: 18rem">Alumno</th>
        <th *ngFor="let d of days()" class="text-center">
          <div class="flex flex-column align-items-center">
            <span class="font-medium">{{ d.d }}</span>
            <small class="text-color-secondary">
              {{ (['Dom','Lun','Mar','Mié','Jue','Vie','Sáb'])[d.dow] }}
            </small>
          </div>
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-row>
      <tr>
        <td>
          <div class="flex flex-column">
            <span class="font-medium">{{ row.name }}</span>
            <small class="text-color-secondary">Legajo: {{ row.legajo }}</small>
          </div>
        </td>

        <td *ngFor="let d of days()" class="text-center">
          <p-checkbox
            binary="true"
            [ngModel]="isPresent(row.userId, d.iso)"
            (ngModelChange)="setPresent(row.userId, d.iso, $event)"
            [inputId]="'att-' + row.userId + '-' + d.iso"
          ></p-checkbox>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="mt-2 text-sm text-color-secondary">
    <span class="inline-flex align-items-center gap-2">
      <span class="legend-box present"></span> Presente
    </span>
    <span class="inline-flex align-items-center gap-2 ml-3">
      <span class="legend-box"></span> Ausente
    </span>
    <span class="inline-flex align-items-center gap-2 ml-3">
      <span class="legend-box weekend"></span> Fin de semana
    </span>
  </div>
</div>

<div class="m-w-custom">
  <p-button label="Volver" icon="pi pi-arrow-left" (onClick)="back()" />

  <div class="flex justify-content-between align-items-center mb-3">
    <h2 class="m-0">Notas &bull; {{ subjectName() }}</h2>
    <div class="flex gap-2">
      <!-- ya no se van a agregar examenes; boton removido -->
    </div>
  </div>

  <ng-container *ngIf="loading(); else loadedTpl">
    <div class="center">
      <p-progressSpinner ariaLabel="Cargando"></p-progressSpinner>
    </div>
  </ng-container>

  <ng-template #loadedTpl>
    <div *ngIf="error(); else contentTpl" class="error">{{ error() }}</div>
  </ng-template>

  <ng-template #contentTpl>
    <p-accordion [multiple]="true" *ngIf="data()?.commissions?.length">
      <p-accordion-panel
        *ngFor="let c of data()!.commissions; let i = index"
        [value]="c.commission.id"
      >
        <p-accordion-header>
          Comision {{ c.commission.letter || c.commission.id }}
        </p-accordion-header>
        <p-accordion-content>
          <p-table
            [value]="c.rows"
            [paginator]="true"
            [rows]="15"
            responsiveLayout="scroll"
            styleClass="p-datatable-sm p-datatable-gridlines"
          >
            <!-- Encabezado -->
            <ng-template pTemplate="header">
              <tr>
                <th class="col-alumno">Nombre/s</th>
                <ng-container *ngIf="c.partials === 2; else headerFourCols">
                  <th class="col-alumno">Nota 1</th>
                  <th class="col-alumno">Nota 2</th>
                  <th class="col-final">Nota Final</th>
                </ng-container>
                <ng-template #headerFourCols>
                  <th class="col-alumno">Nota 1</th>
                  <th class="col-alumno">Nota 2</th>
                  <th class="col-alumno">Nota 3</th>
                  <th class="col-final">Nota 4 (Final)</th>
                </ng-template>
                <th class="col-alumno">Porcentaje de asistencia</th>
                <th class="col-alumno">Condicion</th>
                <!-- seguimos sin saber que es esto: -->
                <th class="col-alumno">Acreditacion</th>
              </tr>
            </ng-template>

            <!-- Cuerpo -->
            <!-- revisar todo el cuerpo -->
            <ng-template pTemplate="body" let-row>
              <tr>
                <td class="col-alumno">
                  <div class="flex flex-column">
                    <span class="font-medium">{{ row.fullName }}</span>
                    <small class="text-color-secondary"
                      >Legajo: {{ row.legajo }}</small
                    >
                  </div>
                </td>

                <ng-container *ngIf="c.partials === 2; else bodyFourCols">
                  <td class="nota">{{ row.note1 ?? '-' }}</td>
                  <td class="nota">{{ row.note2 ?? '-' }}</td>
                  <td class="col-final" [ngClass]="finalClass(row.final)">
                    {{ row.final ?? '-' }}
                  </td>
                </ng-container>
                <ng-template #bodyFourCols>
                  <td class="nota">{{ row.note1 ?? '-' }}</td>
                  <td class="nota">{{ row.note2 ?? '-' }}</td>
                  <td class="nota">{{ row.note3 ?? '-' }}</td>
                  <td class="col-final" [ngClass]="finalClass(row.final)">
                    {{ row.final ?? '-' }}
                  </td>
                </ng-template>

                <td class="col-alumno">
                  {{ row.attendancePercentage !== null &&
                  row.attendancePercentage !== undefined ?
                  row.attendancePercentage + '%' : '-' }}
                </td>
                <td class="col-alumno">{{ row.condition || '-' }}</td>
                <!-- seguimos sin saber que es esto: -->
                <td class="col-alumno"></td>
              </tr>
            </ng-template>
          </p-table>
        </p-accordion-content>
      </p-accordion-panel>
    </p-accordion>
  </ng-template>
</div>

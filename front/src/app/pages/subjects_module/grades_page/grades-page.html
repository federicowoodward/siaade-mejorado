<div class="m-w-custom">
  <p-button label="Volver" icon="pi pi-arrow-left" (onClick)="back()" />
  <div class="flex justify-content-between align-items-center mb-3">
    <h2 class="m-0">Notas • {{ subjectName() }}</h2>
    <div class="flex gap-2">
      <p-button
        label="Agregar examen"
        icon="pi pi-plus"
        (onClick)="openAddExam()"
      />
    </div>
  </div>

  <p-table
    [value]="studentsInSubject()"
    [paginator]="true"
    [rows]="10"
    responsiveLayout="scroll"
  >
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 6rem">Alumno</th>
        <th *ngFor="let ex of exams()" style="width: 6rem">
          <div class="flex flex-column">
            <span class="font-medium">{{ ex.title }}</span>
            <small class="text-color-secondary">{{ ex.date }}</small>
          </div>
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-row>
      <tr>
        <td>
          <div class="flex flex-column">
            <span class="font-medium">{{ row.name }}</span>
            <small class="text-color-secondary">Legajo: {{ row.legajo }}</small>
          </div>
        </td>

        <td *ngFor="let ex of exams()">
          <p-inputNumber
            [min]="0"
            [max]="10"
            [useGrouping]="false"
            mode="decimal"
            [ngModel]="getScore(ex.id, row.userId)"
            (ngModelChange)="setScore(ex.id, row.userId, $event)"
            inputStyleClass="w-6rem"
            [showButtons]="false"
          ></p-inputNumber>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="flex justify-end gap-2 mt-3">
    <p-button
      label="Guardar cambios"
      icon="pi pi-check"
      [disabled]="true"
      pTooltip="MVP: sin persistencia"
    />
  </div>
</div>

<p-dialog
  header="Agregar examen"
  [visible]="showAddExam()"
  (visibleChange)="showAddExam.set($event)"
  [modal]="true"
  [style]="{ width: '480px', maxWidth: '95vw' }"
>
  <div class="flex flex-column gap-3">
    <div>
      <label class="block mb-1">Título</label>
      <input
        pInputText
        class="w-full"
        [(ngModel)]="newExamTitle"
        placeholder="Ej: Parcial 2"
      />
    </div>
    <div>
      <label class="block mb-1">Fecha</label>
      <input
        type="date"
        class="w-full p-inputtext p-component"
        [(ngModel)]="newExamDate"
      />
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button
      label="Cancelar"
      severity="secondary"
      (onClick)="showAddExam.set(false)"
    />
    <p-button label="Agregar" icon="pi pi-check" (onClick)="addExamConfirm()" />
  </ng-template>
</p-dialog>

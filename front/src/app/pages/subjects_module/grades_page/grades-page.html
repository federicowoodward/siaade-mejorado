<div class="m-w-custom">
  <p-button label="Volver" icon="pi pi-arrow-left" (onClick)="back()" />
  <div class="flex justify-content-between align-items-center mb-3">
    <h2 class="m-0">Notas â€¢ {{ subjectName() }}</h2>
    <div class="flex gap-2">
      <p-button label="Agregar examen" icon="pi pi-plus" (onClick)="openAddExam()" />
    </div>
  </div>

  <p-table [value]="studentsInSubject()" [paginator]="true" [rows]="10" responsiveLayout="scroll">
    <!-- Encabezado -->
    <ng-template pTemplate="header">
      <tr>
        <th rowspan="2" class="col-alumno">Alumno</th>
        <th rowspan="2" class="col-alumno">Nota 1</th>
        <th rowspan="2" class="col-alumno">Nota 2</th>
        <!-- esta seccion aparece solo en anuales -->
        <th rowspan="2" class="col-alumno">Nota 3</th>
        <th rowspan="2" class="col-alumno">Nota 4</th>

        <th rowspan="2" class="col-final">Nota Final</th>
        <th rowspan="2" class="col-alumno">Asistencia</th>
        <th rowspan="2" class="col-alumno">Condicion</th>
        <!-- seguimos sin saber que es esto: -->
        <th rowspan="2" class="col-alumno">Acreditacion</th>
      </tr>
    </ng-template>

    <!-- Cuerpo -->
    <!-- revisar todo el cuerpo -->
    <ng-template pTemplate="body" let-row>
      <tr>
        <td class="col-alumno">
          <div class="flex flex-column">
            <span class="font-medium">{{ row.name }}</span>
            <small class="text-color-secondary">Legajo: {{ row.legajo }}</small>
          </div>
        </td>

        <ng-container *ngFor="let ex of exams()">
          <ng-container *ngFor="let i of [].constructor(ex.gradesCount); let index = index">
            <td class="nota">
              <p-inputNumber [min]="0" [max]="10" [useGrouping]="false" mode="decimal"
                [ngModel]="getScore(ex.id, row.userId, index)"
                (ngModelChange)="setScore(ex.id, row.userId, index, $event)" inputStyleClass="nota-input"
                [showButtons]="false"></p-inputNumber>
            </td>
          </ng-container>
        </ng-container>

        <!-- Promedio final -->
        <td class="col-final" [ngClass]="{
          'nota-aprobada': isGradeApproved(getFinalAverage(row.userId)),
          'nota-desaprobada': isGradeDisapproved(getFinalAverage(row.userId)),
          'nota-promocionada': isGradePromoted(getFinalAverage(row.userId))
        }" [pTooltip]="getAverageTooltipText(getFinalAverage(row.userId))">
          {{ getFinalAverage(row.userId) ?? '-' }}
        </td>
      </tr>
    </ng-template>
  </p-table>

  <ng-template pTemplate="footer">
    <p-button label="Cancelar" severity="secondary" (onClick)="showAddExam.set(false)" />
    <!--ya no se van a agregar exaemnes, solo se actualiza la tabla o se cancelan los cambios. -->
    <p-button label="Agregar" icon="pi pi-check" (onClick)="addExamConfirm()" />
  </ng-template>
  </p-dialog>
<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [closable]="false"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '90%', maxWidth: '500px' }"
  styleClass="first-password-modal"
>
  <ng-template pTemplate="header">
    <h3 class="m-0">Cambiar contraseña</h3>
  </ng-template>

  <div class="flex flex-column gap-3">
    <p class="text-color-secondary m-0">
      Por seguridad, debés cambiar tu contraseña antes de continuar.
    </p>

    <form [formGroup]="form" class="flex flex-column gap-3">
      <!-- Nueva contraseña -->
      <div class="flex flex-column gap-2">
        <label for="password" class="font-semibold">Nueva contraseña</label>
        <p-password
          id="password"
          formControlName="password"
          [feedback]="false"
          [toggleMask]="true"
          placeholder="Ingresá tu nueva contraseña"
          styleClass="w-full"
          [inputStyle]="{ width: '100%' }"
        ></p-password>

        <!-- Validaciones visuales -->
        <div class="text-sm" *ngIf="passwordValue.length > 0">
          <div
            [class.text-green-600]="passwordValue.length >= 8"
            [class.text-red-600]="passwordValue.length < 8"
          >
            <i
              [class.pi-check-circle]="passwordValue.length >= 8"
              [class.pi-times-circle]="passwordValue.length < 8"
              class="pi mr-1"
            ></i>
            Mínimo 8 caracteres
          </div>
          <div
            [class.text-green-600]="hasUpper"
            [class.text-red-600]="!hasUpper"
          >
            <i
              [class.pi-check-circle]="hasUpper"
              [class.pi-times-circle]="!hasUpper"
              class="pi mr-1"
            ></i>
            Al menos una mayúscula
          </div>
          <div
            [class.text-green-600]="hasLower"
            [class.text-red-600]="!hasLower"
          >
            <i
              [class.pi-check-circle]="hasLower"
              [class.pi-times-circle]="!hasLower"
              class="pi mr-1"
            ></i>
            Al menos una minúscula
          </div>
          <div
            [class.text-green-600]="hasDigit"
            [class.text-red-600]="!hasDigit"
          >
            <i
              [class.pi-check-circle]="hasDigit"
              [class.pi-times-circle]="!hasDigit"
              class="pi mr-1"
            ></i>
            Al menos un número
          </div>
        </div>
      </div>

      <!-- Confirmar contraseña -->
      <div class="flex flex-column gap-2">
        <label for="confirm" class="font-semibold">Confirmar contraseña</label>
        <p-password
          id="confirm"
          formControlName="confirm"
          [feedback]="false"
          [toggleMask]="true"
          placeholder="Confirmá tu nueva contraseña"
          styleClass="w-full"
          [inputStyle]="{ width: '100%' }"
        ></p-password>

        <div class="text-sm text-red-600" *ngIf="mismatch">
          <i class="pi pi-times-circle mr-1"></i>
          Las contraseñas no coinciden
        </div>
      </div>
    </form>
  </div>

  <ng-template pTemplate="footer">
    <p-button
      label="Guardar"
      icon="pi pi-check"
      [disabled]="!canSubmit || submitting()"
      [loading]="submitting()"
      (onClick)="submit()"
      styleClass="w-full"
    ></p-button>
  </ng-template>
</p-dialog>

<p-toast></p-toast>

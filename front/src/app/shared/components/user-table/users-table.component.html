<h2>Gestión de Usuarios</h2>

<div class="mb-3">
  <!-- Filtro por rol (en el futuro se puede habilitar) -->
  <!--
  <p-autocomplete
    [options]="roles"
    [(ngModel)]="selectedRole()"
    (onChange)="selectedRole.set($event.value)"
    placeholder="Filtrar por rol"
    optionLabel="label"
    class="w-full md:w-14rem"
  />
  -->
</div>

<p-table
  [value]="filteredUsers()"
  [paginator]="true"
  [rows]="10"
  responsiveLayout="scroll"
>
  <ng-template pTemplate="header">
    <tr>
      <th>Nombre</th>
      <th>Email</th>
      <th>Rol</th>
      <th>Acciones</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-user>
    <tr>
      <td>{{ user.name }} {{ user.lastName }}</td>
      <td>{{ user.email }}</td>
      <td>{{ user.rol }}</td>
      <td class="flex gap-2">
        <p-button pButton icon="pi pi-user" (click)="viewDetails(user)" />

        <p-button
          pButton
          icon="pi pi-file"
          (click)="generateCertificate(user)"
          class="p-button-info"
        />

        <p-button
          *ngIf="user.role === 'alumno'"
          pButton
          icon="pi pi-book"
          (click)="viewAcademicStatus(user)"
          class="p-button-secondary"
        />

        <p-button
          *ngIf="user.role === 'docente'"
          pButton
          icon="pi pi-list"
          (click)="viewSubjects(user)"
          class="p-button-warning"
        />
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- Diálogo de Certificado -->
<p-dialog
  header="Acciones de Certificado"
  [visible]="showCertDialog()"
  (visibleChange)="showCertDialog.set($event)"
  [modal]="true"
  resizable="false"
  draggable="false"
  [style]="{ width: '400px' }"
>
  <p>¿Qué acción deseas realizar para {{ selectedUser()?.name }}?</p>
  <div class="flex justify-content-end mt-3 gap-2">
    <p-button pButton label="Generar PDF" (click)="showCertDialog.set(false)" />
    <p-button
      pButton
      label="Ver online"
      class="p-button-secondary"
      (click)="showCertDialog.set(false)"
    />
  </div>
</p-dialog>

<!-- Diálogo para Materias -->
<p-dialog
  header="Materias a Cargo"
  [visible]="showSubjectsDialog()"
  (visibleChange)="showSubjectsDialog.set($event)"
  [modal]="true"
  resizable="false"
  draggable="false"
  [style]="{ width: '400px' }"
>
  <ng-container *ngIf="selectedUser()">
    <p *ngFor="let subject of selectedUser()?.subjects">
      <p-button
        class="p-button-link"
        (click)="confirmSubjectRedirect(subject.id)"
      >
        {{ subject.subject_name }}
      </p-button>
    </p>
  </ng-container>
</p-dialog>

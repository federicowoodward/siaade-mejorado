# Modelo de Datos SIAD — Guía completa (según SVG)

Este documento describe, en **español y con detalle de campos**, el esquema de base de datos diseñado en el SVG adjunto. Incluye **tabla por tabla** con bloques de código comentados para facilitar su lectura e implementación.

> **Convenciones de tipos**
>
> - `DATE`: fecha de calendario (sin hora).
> - `TIMESTAMPTZ`: instante exacto con zona horaria (internamente UTC; recomendado para `created_at`, `updated_at`, `*_set_at`).
> - `DECIMAL(p,s)`: numéricos exactos (notas, promedios, porcentajes).
> - `JSONB`: estructura flexible con validación desde app (p.ej. colecciones de notas).
> - Claves y referencias se anotan con `[pk]`, `[ref: > tabla.campo]`, `[unique]`, etc.

---

## Núcleo de Identidad y Roles

```txt
users {
  // # Identificador universal del usuario del sistema
  id UUID [pk, default: `gen_random_uuid()`]

  // # Nombre y apellido visibles
  name TEXT
  last_name TEXT

  // # Email único (login/recuperación)
  email TEXT [unique]

  // # Hash de contraseña (si aplica login local)
  password TEXT

  // # Identificador fiscal único
  cuil TEXT [unique]

  // # Rol del usuario (alumno, docente, preceptor, secretario, admin)
  role_id INT [not null, ref: > roles.id]
}
```

```txt
roles {
  // # Identificador del rol
  id INTEGER [pk, note: 'GENERATED BY DEFAULT AS IDENTITY']

  // # Nombre único del rol
  name TEXT [not null, unique]
}
```

```txt
user_info {
  // # Identificador del registro de info extendida
  id INTEGER [pk, note: 'GENERATED BY DEFAULT AS IDENTITY']

  // # Usuario al que pertenece la info
  user_id INTEGER [not null, ref: > users.id]

  // # Documento: tipo/valor (DNI, Pasaporte, etc.)
  document_type TEXT
  document_value TEXT

  // # Contacto personal y de emergencia
  phone TEXT
  emergency_name TEXT
  emergency_phone TEXT
}
```

```txt
common_data {
  // # Identificador del registro común
  id INTEGER [pk, note: 'GENERATED BY DEFAULT AS IDENTITY']

  // # Usuario al que aplica
  user_id INTEGER [not null, ref: > users.id]

  // # Dirección asociada (si existe)
  address_data_id INTEGER [ref: > address_data.id]

  // # Datos demográficos
  sex TEXT
  birth_date DATE
  birth_place TEXT
  nationality TEXT
}
```

```txt
address_data {
  // # Identificador de domicilio
  id INTEGER [pk, note: 'GENERATED BY DEFAULT AS IDENTITY']

  // # Partes de la dirección
  street TEXT
  number TEXT
  floor TEXT
  apartment TEXT
  neighborhood TEXT
  locality TEXT
  province TEXT
  postal_code TEXT
  country TEXT
}
```

**Actores académicos**

```txt
students {
  // # PK enlaza 1:1 con users
  user_id INTEGER [pk, ref: > users.id]

  // # Legajo único institucional
  legajo TEXT [unique]

  // # Permite/deniega login del alumno (gestionado por preceptoría)
  can_login BOOL
}
```

```txt
teachers {
  // # PK enlaza 1:1 con users
  user_id INTEGER [pk, ref: > users.id]
}
```

```txt
preceptors {
  // # PK enlaza 1:1 con users
  user_id INTEGER [pk, ref: > users.id]
}
```

```txt
secretaries {
  // # PK enlaza 1:1 con users
  user_id INTEGER [pk, ref: > users.id]

  // # Marca si tiene jerarquía directiva
  is_directive BOOLEAN [default: false]
}
```

---

## Estructura Académica

```txt
academic_period {
  // # Identificador del período académico
  academic_period_id SERIAL [pk]

  // # Nombre (p.ej. "1er cuatrimestre 2025", "Anual 2025")
  period_name TEXT [not null]

  // # Cantidad de parciales que exige el período (2 o 4)
  parcials_score_needed SMALLINT
}
```

```txt
careers {
  // # Identificador de la carrera/plan
  id SERIAL [pk]

  // # Nombre de la carrera (p.ej. "Tecnicatura en ...")
  career_name TEXT [not null]

  // # Período académico que rige su cursada (catálogo)
  academic_period_id INTEGER [not null, ref: > academic_period.academic_period_id]

  // # Preceptor responsable de la carrera
  preceptor_id INTEGER [not null, ref: - preceptors.user_id]

  // # Timestamps de auditoría
  created_at TIMESTAMPTZ [default: `now()`]
  updated_at TIMESTAMPTZ [default: `now()`]
}
```

```txt
career_students {
  // # Identificador de la asociación carrera-estudiante
  id SERIAL [pk]

  // # Carrera
  career_id INTEGER [not null, ref: > careers.id]

  // # Estudiante
  student_id INTEGER [not null, ref: > students.user_id]

  // # Fecha en la que se agrega a la carrera
  enrolled_at DATE
}
```

---

## Materias y correlatividades

```txt
subjects {
  // # Identificador de la materia
  id SERIAL [pk]

  // # Nombre de la materia
  subject_name TEXT

  // # Docente responsable
  teacher INTEGER [ref: - teachers.user_id, not null]

  // # Período académico al que pertenece la materia
  academic_period_id INTEGER [ref: > academic_period.academic_period_id]

  // # Número de orden para correlatividades por "orden"
  order_no INTEGER

  // # Correlativa textual (compatibilidad / transición)
  correlative TEXT [ref: - subjects.id]

  // # Datos decorativos (solo informativos, salen del documento principal)
  teacher_formation TEXT
  subject_format TEXT
  annual_workload TEXT
  weekly_workload TEXT
}
```

> **Correlatividades**  
> El modelo admite dos enfoques:  
> - **Por orden** (`order_no`) y **conjunto de números de orden** planificados a nivel aplicación.  
> - **Texto de compatibilidad** (`correlative`) hacia otra materia (útil en transición).

---

## Inscripción al cursado y condición académica por materia

```txt
subject_enrollments {
  // # Identificador de la inscripción a materia
  id SERIAL [pk]

  // # Materia a la que se inscribe
  subject_id INTEGER [ref: > subjects.id, not null]

  // # Estudiante que se inscribe
  student_id INTEGER [ref: - students.user_id, not null]

  // # Fecha de alta administrativa (día calendario)
  enrollment_date DATE

  // # Condición/estado del alumno en la materia:
  // # 'inscripto' | 'regular' | 'promocional' | 'libre' | 'aprobado'
  status TEXT

  // # Instante exacto en que se fijó el último estado
  status_set_at TIMESTAMPTZ [default: `now()`]
}
```

> **Notas**
> - “**No inscripto**” se representa como **ausencia** de fila `(subject_id, student_id)`.
> - `status` es **académico/administrativo** (no rendimiento).  
> - Sugerencia de índice único a nivel SQL (implementación): `UNIQUE(subject_id, student_id)`.

---

## Progreso (notas y asistencia) por alumno–materia

```txt
student_subject_progress {
  // # Materia y estudiante (par único)
  subject_id INTEGER [not null, ref: - subjects.id]
  student_id INTEGER [not null, ref: - students.user_id]

  // # Notas parciales: JSONB flexible (p.ej. {"1":7,"2":8} o {"1":9,"2":10,"3":8,"4":9})
  partial_scores JSONB

  // # Promedio final calculado
  average_score DECIMAL(4,2)

  // # Porcentaje de asistencia (cargado por el docente)
  attendance_percentage DECIMAL(5,2)

  // # Última actualización del registro de progreso
  updated_at TIMESTAMPTZ [default: `now()`]
}
```

> **Regla del período académico**  
> La app debe validar que la **cantidad de parciales** en `partial_scores` coincida con `academic_period.parcials_score_needed` de la materia.

---

## Inasistencias por materia

```txt
subject_absences {
  // # Identificador de registro de inasistencias
  id INTEGER [pk, note: 'GENERATED BY DEFAULT AS IDENTITY']

  // # Materia
  subject_id INTEGER [not null, ref: > subjects.id]

  // # Estudiante (nota: tipo UUID vs INTEGER en students.user_id; planificar migración)
  student_id UUID [not null, ref: > students.user_id]

  // # Lista de fechas de inasistencia (día calendario)
  dates DATE[] [not null, note: 'Array de fechas de inasistencias']
}
```

---

## Mesas de examen final

```txt
exam_table {
  // # Identificador de la mesa de examen
  id INTEGER [pk, note: 'GENERATED BY DEFAULT AS IDENTITY']

  // # Nombre visible (p.ej. "Mesa diciembre 2025")
  name TEXT [not null]

  // # Ventana de la mesa (validación para crear finales)
  start_date DATE [not null]
  end_date DATE [not null]

  // # Secretario que crea la mesa
  created_by INTEGER [ref: > secretaries.user_id, not null]
}
```

```txt
final_exams {
  // # Identificador del examen final dentro de la mesa
  id INTEGER [pk, note: 'GENERATED BY DEFAULT AS IDENTITY']

  // # Mesa a la que pertenece (nota: UUID vs INTEGER en exam_table.id; plan migratorio)
  exam_table_id UUID [not null, ref: > exam_table.id]

  // # Materia a evaluar
  subject_id INTEGER [not null, ref: > subjects.id]

  // # Fecha (y opcionalmente hora si se decide) y aula
  exam_date DATE [not null]
  aula TEXT
}
```

```txt
final_exams_students {
  // # Identificador de la inscripción del alumno a un final
  id INTEGER [pk, note: 'GENERATED BY DEFAULT AS IDENTITY']

  // # Final y alumno asociados
  final_exams_id UUID [not null, ref: > final_exams.id]
  student_id INTEGER [not null, ref: - students.user_id]

  // # Inscripción y su fecha
  enrolled BOOL
  enrolled_at DATE

  // # Nota final y observaciones del acta
  score DECIMAL(4,2)
  notes TEXT
}
```

---

## Relaciones clave (resumen)

- `users (1) — (1) students/teachers/preceptors/secretaries` por PK compartida (`user_id`).
- `roles (1) — (N) users` vía `users.role_id`.
- `address_data (1) — (N) common_data` vía `common_data.address_data_id`.
- `academic_period (1) — (N) subjects` vía `subjects.academic_period_id`.
- `careers (1) — (N) career_students` y `students (1) — (N) career_students`.
- `subjects (1) — (N) subject_enrollments` y `students (1) — (N) subject_enrollments`.
- `subjects (1) — (N) student_subject_progress` y `students (1) — (N) student_subject_progress`.
- `subjects (1) — (N) subject_absences` y `students (1) — (N) subject_absences`.
- `exam_table (1) — (N) final_exams`; `subjects (1) — (N) final_exams`.
- `final_exams (1) — (N) final_exams_students`; `students (1) — (N) final_exams_students`.

---

## Reglas operativas básicas

1. **Inscripción al cursado**  
   - Para que un alumno esté **inscripto** a una materia debe existir una fila en `subject_enrollments (subject_id, student_id)`.
   - El **estado académico** por materia (`status`) vive en `subject_enrollments`.  
     Valores sugeridos: `inscripto | regular | promocional | libre | aprobado`.  
     “No inscripto” = **no hay fila**.

2. **Rendimiento y asistencia**  
   - Notas parciales y cálculo de promedio están en `student_subject_progress`.  
   - La cantidad de parciales se valida contra `academic_period.parcials_score_needed`.  
   - La **asistencia** se carga manualmente; las **inasistencias** se listan en `subject_absences.dates`.

3. **Finales**  
   - Los finales solo pueden crearse dentro de la ventana `[exam_table.start_date, exam_table.end_date]`.  
   - Inscripción a final y nota final se registran en `final_exams_students`.

4. **Trazabilidad de tiempo**  
   - Usar `DATE` para hitos de **día completo** (`enrollment_date`, `start_date`, `end_date`, `enrolled_at`).  
   - Usar `TIMESTAMPTZ` para **instantes exactos** (`created_at`, `updated_at`, `status_set_at`, auditorías).

---

## Índices recomendados

- `UNIQUE(subject_id, student_id)` en `subject_enrollments` y `student_subject_progress`.  
- Índices por FK frecuentes: `subjects.teacher`, `subjects.academic_period_id`, `career_students.career_id`, `career_students.student_id`, `subject_absences.subject_id`, `final_exams.subject_id`, `final_exams_students.final_exams_id`.

---

> **Notas de compatibilidad detectadas en el SVG**
>
> - `subject_absences.student_id` es `UUID` mientras `students.user_id` es `INTEGER`.  
>   Mantener por ahora y planificar migración a un tipo consistente.
> - `final_exams.exam_table_id` figura `UUID` y `exam_table.id` `INTEGER`.  
>   Igual: mantener por compatibilidad y migrar cuando sea oportuno.

---

### Checklist mínimo para “estar OK” según el diagrama

- [x] Carreras con períodos académicos y preceptor responsable.  
- [x] Materias con docente, período académico, orden y (si hace falta) correlativa textual + datos decorativos.  
- [x] Inscripción al cursado por materia con **estado académico** y fecha de alta.  
- [x] Progreso por alumno–materia con parciales en `JSONB`, promedio y asistencia.  
- [x] Inasistencias como arreglo de fechas.  
- [x] Mesas de examen con finales y actas de alumnos (inscripción, nota, observaciones).  
- [x] Timestamps `TIMESTAMPTZ` donde hace falta auditoría; `DATE` para hitos de calendario.  